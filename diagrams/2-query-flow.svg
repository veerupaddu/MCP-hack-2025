<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800">
  <defs>
    <style>
      .title { font: bold 24px sans-serif; fill: #1a1a1a; }
      .subtitle { font: 16px sans-serif; fill: #666; }
      .box { fill: #f0f7ff; stroke: #2563eb; stroke-width: 2; }
      .box-header { fill: #2563eb; }
      .box-text { font: 14px sans-serif; fill: #1a1a1a; }
      .box-header-text { font: bold 14px sans-serif; fill: white; }
      .arrow { stroke: #2563eb; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .metric { font: 12px monospace; fill: #059669; font-weight: bold; }
      .fast { fill: #d1fae5; stroke: #059669; }
      .component { fill: #fef3c7; stroke: #d97706; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#2563eb" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="600" y="40" class="title" text-anchor="middle">RAG Query Flow - Detailed Architecture</text>
  <text x="600" y="65" class="subtitle" text-anchor="middle">vLLM-Optimized Retrieval-Augmented Generation System</text>
  
  <!-- User Request -->
  <rect x="50" y="120" width="150" height="80" class="box" rx="8"/>
  <rect x="50" y="120" width="150" height="35" class="box-header" rx="8"/>
  <text x="125" y="142" class="box-header-text" text-anchor="middle">USER REQUEST</text>
  <text x="125" y="175" class="box-text" text-anchor="middle">ðŸ’¬ Question</text>
  
  <path d="M 200 160 L 240 160" class="arrow"/>
  
  <!-- API Endpoint -->
  <rect x="240" y="120" width="160" height="80" class="box" rx="8"/>
  <rect x="240" y="120" width="160" height="35" class="box-header" rx="8"/>
  <text x="320" y="142" class="box-header-text" text-anchor="middle">API ENDPOINT</text>
  <text x="320" y="175" class="box-text" text-anchor="middle">FastAPI POST</text>
  
  <path d="M 400 160 L 440 160" class="arrow"/>
  
  <!-- RAG Model Container -->
  <rect x="440" y="100" width="710" height="550" fill="#f8fafc" stroke="#475569" stroke-width="3" rx="12"/>
  <text x="795" y="130" class="title" text-anchor="middle" font-size="18">RAG Model Container (Modal A10G GPU)</text>
  
  <!-- Embedding Model -->
  <rect x="470" y="160" width="200" height="100" class="component" rx="8"/>
  <rect x="470" y="160" width="200" height="35" class="box-header" rx="8"/>
  <text x="570" y="182" class="box-header-text" text-anchor="middle">EMBEDDING MODEL</text>
  <text x="570" y="210" class="box-text" text-anchor="middle">bge-small-en-v1.5</text>
  <text x="570" y="230" class="box-text" text-anchor="middle">GPU: CUDA</text>
  <text x="570" y="250" class="metric" text-anchor="middle">~2ms</text>
  
  <path d="M 670 210 L 720 210" class="arrow"/>
  
  <!-- Vector Database -->
  <rect x="720" y="160" width="200" height="100" class="fast" rx="8"/>
  <rect x="720" y="160" width="200" height="35" class="box-header" rx="8"/>
  <text x="820" y="182" class="box-header-text" text-anchor="middle">VECTOR DB</text>
  <text x="820" y="210" class="box-text" text-anchor="middle">ChromaDB (Local)</text>
  <text x="820" y="230" class="box-text" text-anchor="middle">3,766 docs</text>
  <text x="820" y="250" class="metric" text-anchor="middle">~400ms</text>
  
  <path d="M 820 260 L 820 300" class="arrow"/>
  
  <!-- Context Builder -->
  <rect x="720" y="300" width="200" height="80" class="box" rx="8"/>
  <rect x="720" y="300" width="200" height="35" class="box-header" rx="8"/>
  <text x="820" y="322" class="box-header-text" text-anchor="middle">CONTEXT BUILDER</text>
  <text x="820" y="355" class="box-text" text-anchor="middle">Top-3 documents</text>
  <text x="820" y="372" class="box-text" text-anchor="middle">+ metadata</text>
  
  <path d="M 720 340 L 670 340" class="arrow"/>
  
  <!-- Prompt Constructor -->
  <rect x="470" y="300" width="200" height="80" class="box" rx="8"/>
  <rect x="470" y="300" width="200" height="35" class="box-header" rx="8"/>
  <text x="570" y="322" class="box-header-text" text-anchor="middle">PROMPT BUILDER</text>
  <text x="570" y="355" class="box-text" text-anchor="middle">Alpaca Template</text>
  <text x="570" y="372" class="box-text" text-anchor="middle">Context + Question</text>
  
  <path d="M 570 380 L 570 420" class="arrow"/>
  
  <!-- vLLM Engine -->
  <rect x="470" y="420" width="430" height="140" class="fast" rx="8"/>
  <rect x="470" y="420" width="430" height="40" class="box-header" rx="8"/>
  <text x="685" y="445" class="box-header-text" text-anchor="middle" font-size="16">vLLM AsyncLLMEngine</text>
  
  <rect x="490" y="475" width="190" height="70" fill="white" stroke="#059669" stroke-width="1" rx="6"/>
  <text x="585" y="495" class="box-text" text-anchor="middle" font-weight="bold">Fine-tuned Model</text>
  <text x="585" y="515" class="box-text" text-anchor="middle">Phi-3-mini-4k</text>
  <text x="585" y="535" class="metric" text-anchor="middle">merged_model/</text>
  
  <rect x="700" y="475" width="180" height="70" fill="white" stroke="#059669" stroke-width="1" rx="6"/>
  <text x="790" y="495" class="box-text" text-anchor="middle" font-weight="bold">Generation</text>
  <text x="790" y="515" class="box-text" text-anchor="middle">GPU: 70%</text>
  <text x="790" y="535" class="metric" text-anchor="middle">~2-3s</text>
  
  <path d="M 685 560 L 685 600" class="arrow"/>
  
  <!-- Response Formatter -->
  <rect x="570" y="600" width="230" height="80" class="box" rx="8"/>
  <rect x="570" y="600" width="230" height="35" class="box-header" rx="8"/>
  <text x="685" y="622" class="box-header-text" text-anchor="middle">RESPONSE FORMATTER</text>
  <text x="685" y="650" class="box-text" text-anchor="middle">Answer + Sources + Metrics</text>
  <text x="685" y="670" class="metric" text-anchor="middle">JSON Response</text>
  
  <!-- Performance Metrics -->
  <rect x="50" y="240" width="350" height="180" fill="#f0fdf4" stroke="#059669" stroke-width="2" rx="8"/>
  <text x="225" y="270" class="box-text" text-anchor="middle" font-weight="bold" font-size="18">Performance Metrics</text>
  
  <text x="70" y="305" class="box-text">Embedding Generation:</text>
  <text x="360" y="305" class="metric" text-anchor="end">~2ms</text>
  
  <text x="70" y="335" class="box-text">Vector Search (Local):</text>
  <text x="360" y="335" class="metric" text-anchor="end">~400ms</text>
  
  <text x="70" y="365" class="box-text">LLM Generation (vLLM):</text>
  <text x="360" y="365" class="metric" text-anchor="end">~2-3s</text>
  
  <rect x="70" y="380" width="290" height="30" fill="#d1fae5" stroke="#059669" stroke-width="2" rx="4"/>
  <text x="225" y="402" class="metric" text-anchor="middle" font-size="16">TOTAL LATENCY: &lt;3s âš¡</text>
  
  <!-- Tech Stack -->
  <rect x="50" y="450" width="350" height="200" fill="#fef3c7" stroke="#d97706" stroke-width="2" rx="8"/>
  <text x="225" y="480" class="box-text" text-anchor="middle" font-weight="bold" font-size="18">Technology Stack</text>
  
  <text x="70" y="515" class="box-text" font-weight="bold">Inference:</text>
  <text x="90" y="540" class="box-text">â€¢ vLLM 0.6.3 (AsyncLLMEngine)</text>
  
  <text x="70" y="570" class="box-text" font-weight="bold">Retrieval:</text>
  <text x="90" y="595" class="box-text">â€¢ ChromaDB 0.5.20 (Local)</text>
  <text x="90" y="615" class="box-text">â€¢ sentence-transformers 3.3.0</text>
  
  <text x="70" y="640" class="box-text" font-weight="bold">Framework:</text>
  <text x="90" y="665" class="box-text">â€¢ LangChain 0.3.7</text>
  
  <!-- Footer -->
  <text x="600" y="790" class="subtitle" text-anchor="middle" font-size="12">Endpoint: rag-vllm-optimized | Infrastructure: Modal A10G GPU | Updated: 2025-11-30</text>
</svg>